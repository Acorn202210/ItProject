<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="lectureStudent">
<select id="getData" parameterType="lectureStudentDto" resultType="lectureStudentDto">
	SELECT * FROM LECTURE_STUDENT
	WHERE id=#{id} AND ref_group=#{ref_group}
</select>

<select id="studentList" parameterType="lectureStudentDto" resultType="lectureStudentDto">
  SELECT *
		FROM	
			(SELECT result1.*, ROWNUM as rnum
			FROM
				(SELECT users.id,TO_CHAR(birth,'YYYY-MM-DD') birth, phone, email, regdate, Large_category, small_category
				FROM users 
				JOIN LECTURE_STUDENT
				ON users.id=LECTURE_STUDENT.id
				JOIN LECTURE 
				on LECTURE.num=LECTURE_STUDENT.ref_group
				<choose>
					<when test="small_category==0">
						WHERE Large_category=#{Large_category}
					</when>
					<when test="small_category!=null">
						WHERE Large_category=#{Large_category} AND small_category=#{small_category}
					</when>
				</choose>
				ORDER BY users.id DESC) result1)
		WHERE rnum BETWEEN #{startRowNum} AND #{endRowNum}
</select>   
  
  <insert id="lectureSignup" parameterType="lectureStudentDto">
	  INSERT INTO LECTURE_STUDENT
			(num, id, ref_group)
			VALUES(#{num}, #{id}, #{ref_group})
   </insert>
   
   
   <select id="getSequence" resultType="int">
      SELECT LECTURE_STUDENT_seq.NEXTVAL
      FROM DUAL
   </select>
   
   	<select id="getCount" resultType="int">
		SELECT NVL(MAX(ROWNUM), 0)
		FROM LECTURE_STUDENT
	</select>
</mapper>